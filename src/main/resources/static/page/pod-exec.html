<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../lib/highlight-11.7.0/styles/default.min.css" media="all">
    <link rel="stylesheet" href="../css/public.css" media="all">
    <style>

        pre {
            overflow: auto
        }

        .editarea {
            width: 1px;
            height: 90vh;
            flex-grow: 1
        }

    </style>
</head>
<body>
<div class="layuimini-container">
    <div>
        <input type="text" id="command" > <button class="layui-btn layui-btn-xs" id="sendCommand">send</button>

    </div>
    <div class="layuimini-main" id="main">



    </div>
</div>
<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script src="../lib/js-yaml-4.1.0/js-yaml.js" charset="utf-8"></script>
<script src="../lib/highlight-11.7.0/highlight.js" charset="utf-8"></script>
<script src="../lib/highlight-11.7.0/languages/yaml.min.js" charset="utf-8"></script>
<script src="../lib/highlight-11.7.0/languages/json.min.js" charset="utf-8"></script>
<script>

    console.log(window.yaml)
    const podNamespace = localStorage.getItem('podNamespace')
    const podName = localStorage.getItem('podName')
    window.k8sId = parent.k8sId
    window.namespace = parent.namespace
    window.podName = parent.podName

    layui.use(['form', 'table','element'], function () {

        var $ = layui.jquery,
            form = layui.form,
            element = layui.element,
            table = layui.table;
        var main = document.getElementById('main')
        var socket = new WebSocket(`ws://192.168.0.142:8080/wsexec/${window.k8sId}/${window.namespace}/${window.podName}`)
        socket.onopen = function(event) {
            console.log('WebSocket is connected.');
        };
        socket.onmessage = function(event) {
            console.log('Received message: ' + event.data);
            main.innerText += event.data + '\r\n'
            main.scrollIntoView(false)
        };
        socket.onerror = function(event) {
            console.error('WebSocket error observed:', event);
        };
        socket.onclose = function(event) {
            console.log('WebSocket is closed with code ' + event.code);
        };

        $('#sendCommand').on('click', ()=> {
             const command = document.getElementById("command").value
            console.log('conmand', command)
            socket.send(command)
        })

    });
</script>

</body>
</html>
